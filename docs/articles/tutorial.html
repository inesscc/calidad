<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="calidad">
<title>basic usage • calidad</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="basic usage">
<meta property="og:description" content="calidad">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">calidad</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/tutorial.html">basic usage</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="tutorial_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>basic usage</h1>
            
      
      
      <div class="d-none name"><code>tutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="tutorial-package-calidad">Tutorial package calidad<a class="anchor" aria-label="anchor" href="#tutorial-package-calidad"></a>
</h2>
<p>The package aims to implement in a simple way the methodologies of <a href="https://www.ine.cl/docs/default-source/documentos-de-trabajo/20200318-lineamientos-medidas-de-precisi%C3%B3n.pdf?sfvrsn=f1ab2dbe_4" class="external-link">INE Chile</a> and <a href="https://repositorio.cepal.org/bitstream/handle/11362/45681/S2000293_es.pdf?sequence=4&amp;isAllowed=y" class="external-link">ECLAC</a> for the quality evaluation of estimates from household surveys.</p>
<p>This tutorial shows the basic use of the package and includes the main functions to create the necessary inputs to implement both quality standards.</p>
<div class="section level3">
<h3 id="data-edition">Data edition<a class="anchor" aria-label="anchor" href="#data-edition"></a>
</h3>
<p>We will use two datasets:</p>
<ul>
<li>Encuesta Nacional de Empleo (efm 2020)<br>
</li>
<li>VIII Encuesta de Presupuestos Familiares</li>
</ul>
<p>Both datasets are loaded into the package and they can be used when the package is loaded in the session <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The data contained within the package has some editions. It is important to note that haven::labelled objects may have some collision with quality functions. If you want to import a dta file, all variables that are of type haven::labelled must be converted to numeric or character.&lt;/p&gt;"><sup>1</sup></a>. The data edition in the case of ENE has the purpuse of creating some subpopulations (work force, unemployed and unemployed).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">calidad</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">ene</span> <span class="op">&lt;-</span> <span class="va">ene</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>fdt <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">cae_especifico</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">cae_especifico</span> <span class="op">&lt;=</span> <span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, <span class="co"># labour force</span></span>
<span>         ocupado <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">cae_especifico</span> <span class="op">&gt;=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">cae_especifico</span> <span class="op">&lt;=</span> <span class="fl">7</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, <span class="co"># employed</span></span>
<span>         desocupado <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">cae_especifico</span> <span class="op">&gt;=</span> <span class="fl">8</span> <span class="op">&amp;</span> <span class="va">cae_especifico</span> <span class="op">&lt;=</span> <span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co"># unemployed</span></span>
<span></span>
<span><span class="co"># One row per household</span></span>
<span><span class="va">epf</span> <span class="op">&lt;-</span> <span class="va">epf_personas</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">folio</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sample-design">Sample design<a class="anchor" aria-label="anchor" href="#sample-design"></a>
</h3>
<p>Before starting to use the package, it is necessary to declare the sample design of the survey, for which we use the <code>survey</code> package. The primary sample unit, the stratum and weights must be declared. It is also possible to use a design with only weights, nevertheless in that case the variance will be estimated under simple random sampling assumption. In this case we will declare a complex design for the two surveys (EPF and ENE). Additionally, it may be useful to declare an option for strata that only have one PSU.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store original options</span></span>
<span><span class="va">old_options</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Complex sample design for ENE</span></span>
<span><span class="va">dc_ene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">conglomerado</span> , strata <span class="op">=</span> <span class="op">~</span><span class="va">estrato_unico</span>, data <span class="op">=</span> <span class="va">ene</span>, weights <span class="op">=</span> <span class="op">~</span><span class="va">fact_cal</span><span class="op">)</span></span>
<span><span class="co"># Complex sample design for EPF</span></span>
<span><span class="va">dc_epf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">varunit</span>, strata <span class="op">=</span> <span class="op">~</span><span class="va">varstrat</span>, data <span class="op">=</span> <span class="va">epf</span>, weights <span class="op">=</span> <span class="op">~</span><span class="va">fe</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>survey.lonely.psu <span class="op">=</span> <span class="st">"certainty"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inputs-creation">Inputs creation<a class="anchor" aria-label="anchor" href="#inputs-creation"></a>
</h3>
<div class="section level4">
<h4 id="national-labour-survey-part-1">National Labour Survey (part 1)<a class="anchor" aria-label="anchor" href="#national-labour-survey-part-1"></a>
</h4>
<p>To assess the quality of an estimate, the <a href="https://www.ine.cl/docs/default-source/documentos-de-trabajo/20200318-lineamientos-medidas-de-precisi%C3%B3n.pdf?sfvrsn=f1ab2dbe_4" class="external-link">INE methodology</a> establishes differentiated criteria for estimates of proportion (or ratio), on the one hand, and estimates of mean, size and total, on the other. In the case of proportion estimation, it is necessary to have the sample size, the degrees of freedom and the standard error. The other estimates require the sample size, the degrees of freedom, and the coefficient of variation.</p>
<p>The package includes separate functions to create the inputs for estimates of <strong>mean, proportion, totals and size</strong>. The following example shows how the proportion and size functions are used.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">insumos_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_prop.html">create_prop</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"desocupado"</span>, domains <span class="op">=</span> <span class="st">"sexo"</span>, subpop <span class="op">=</span> <span class="st">"fdt"</span>, design <span class="op">=</span>  <span class="va">dc_ene</span><span class="op">)</span> <span class="co"># proportion of unemployed people</span></span>
<span><span class="va">insumos_total</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/create_size.html">create_size</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"desocupado"</span>, domains <span class="op">=</span> <span class="st">"sexo"</span>, subpop <span class="op">=</span> <span class="st">"fdt"</span>, design <span class="op">=</span>  <span class="va">dc_ene</span><span class="op">)</span> <span class="co"># number of unemployed people</span></span></code></pre></div>
<ul>
<li>
<code>var</code>: variable to be estimated. Must be a dummy variable</li>
<li>
<code>domains</code>: required domains.</li>
<li>
<code>subpop</code>: reference subpopulation. It is optional and works as a filter (must be a dummy variable)</li>
<li>
<code>design</code>: sample design</li>
</ul>
<p>The function returns all the neccesary inputs to implement the standard</p>
<p>To get more domains, we can use the “+” symbol as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">desagregar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_prop.html">create_prop</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"desocupado"</span>, domains <span class="op">=</span> <span class="st">"sexo+region"</span>, subpop <span class="op">=</span> <span class="st">"fdt"</span>, design <span class="op">=</span>  <span class="va">dc_ene</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="household-budget-survey-part-2">Household Budget Survey (part 2)<a class="anchor" aria-label="anchor" href="#household-budget-survey-part-2"></a>
</h4>
<p>In some cases it may be of interest to assess the quality of a sum. For example, the sum of all the income of the EPF at the geographical area level (Gran Santiago and other regional capitals). For this, there is the <code>create_total</code> function. This function receives a continuous variable such as hours, expense, or income and generates totals at the requested level. The ending “with” of the function alludes to the fact that a continuous variable is being used.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">insumos_suma</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/create_total.html">create_total</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"gastot_hd"</span>, domains <span class="op">=</span> <span class="st">"zona"</span>, design <span class="op">=</span>  <span class="va">dc_epf</span><span class="op">)</span></span></code></pre></div>
<p>If we want to evaluate the estimate of a mean, we have the function <code>create_mean</code>. In this case, we will calculate the average expenditure of households, according to geographical area.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">insumos_media</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/create_mean.html">create_mean</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"gastot_hd"</span>, domains <span class="op">=</span> <span class="st">"zona"</span>, design <span class="op">=</span>  <span class="va">dc_epf</span><span class="op">)</span></span></code></pre></div>
<p>The default usage is not to disaggregate, in which case the functions should be used as follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ENE dataset</span></span>
<span><span class="va">insumos_prop_nacional</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_prop.html">create_prop</a></span><span class="op">(</span><span class="st">"desocupado"</span>, subpop <span class="op">=</span> <span class="st">"fdt"</span>, design <span class="op">=</span> <span class="va">dc_ene</span><span class="op">)</span></span>
<span><span class="va">insumos_total_nacional</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/create_total.html">create_total</a></span><span class="op">(</span><span class="st">"desocupado"</span>, subpop <span class="op">=</span> <span class="st">"fdt"</span>, design <span class="op">=</span> <span class="va">dc_ene</span><span class="op">)</span></span>
<span><span class="co"># EPF dataset</span></span>
<span><span class="va">insumos_suma_nacional</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_total.html">create_total</a></span><span class="op">(</span><span class="st">"gastot_hd"</span>, design <span class="op">=</span> <span class="va">dc_epf</span><span class="op">)</span></span>
<span><span class="va">insumos_media_nacional</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/create_mean.html">create_mean</a></span><span class="op">(</span><span class="st">"gastot_hd"</span>, design <span class="op">=</span> <span class="va">dc_epf</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="evaluation">Evaluation<a class="anchor" aria-label="anchor" href="#evaluation"></a>
</h3>
<p>Once the inputs have been generated, we can do the evaluation. To do this, we use the <code>evaluate</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evaluacion_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">insumos_prop</span><span class="op">)</span></span>
<span><span class="va">evaluacion_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">insumos_total</span><span class="op">)</span></span>
<span><span class="va">evaluacion_suma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">insumos_suma</span><span class="op">)</span></span>
<span><span class="va">evaluacion_media</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">insumos_media</span><span class="op">)</span></span></code></pre></div>
<p>The output is a <code>dataframe</code> that, in addition to containing the information already generated, includes a column that indicates whether the estimate is unreliable, less reliable or reliable.</p>
<p>The function <code>evaluate</code> has a parameter that allows us to know if the table should be published or not. Following the criteria of the standard, if more than 50% of the estimates of a table are not reliable, it should not be published.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Desempleo desagregado por region</span></span>
<span><span class="va">desagregar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_size.html">create_size</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"desocupado"</span>, domains <span class="op">=</span> <span class="st">"region"</span>, subpop <span class="op">=</span> <span class="st">"fdt"</span>, design <span class="op">=</span>  <span class="va">dc_ene</span><span class="op">)</span></span>
<span><span class="co"># Evaluar tabulado</span></span>
<span><span class="va">evaluacion_tot_desagreg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate.html">evaluate</a></span><span class="op">(</span><span class="va">desagregar</span>, publicar <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reset original options</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">old_options</span><span class="op">)</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Klaus Lehmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
